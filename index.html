<!DOCTYPE html>

<html lang="en">
<head>

  <meta charset="UTF-8" />
  <title>Project Demo</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@200&family=Zen+Kurenaido&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">
   <script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.5/ScrollMagic.min.js"></script>

<meta charset="utf-8" />
<title>Telling Migrant Stories</title>
<style>
.node rect {
  cursor: move;
  fill-opacity: .9;
  shape-rendering: crispEdges;
}

.node text {
  pointer-events: none;
  font-family: 'Trebuchet MS', sans-serif;
  /* text-shadow: 0 1px 0 #fff; */
  /* background: white; */

}

.link {
  stroke: #fff;
  stroke-opacity: .15;
}

.link:hover {
  stroke-opacity: .25;
}

/* svg {
  position: absolute;
} */

canvas {
  position: absolute;
  margin-left: 652px;
  margin-top: 52px;
}
h1{
  color:white;
  font-family: 'Trebuchet MS', sans-serif;
}

svg.sankeone{
  position: absolute;
}

canvas.top{
  margin-left: 50px;
  margin-top:150px;
  position:absolute;
}


svg.sankeytwo{
  margin-left: 50px;
}

body{
  background-color: #264653;
}
p {
  font-family: 'Nunito', sans-serif;
  color: #e9c46a;
  font-weight:300;
  padding: 50px;
}

/* svg {
  width:100%;
  height:600px;
  padding-left:5%;
  padding-right:50px;
} */

h1 {
  color: #df2935;
  font-family: 'Zen Kurenaido', sans-serif;
  font-size:60px;
  font-weight:100;
  line-height:1.3;
  padding-bottom: 150px;
}

h2{
  color: #e9c46a;
  font-family: 'Zen Kurenaido', sans-serif;
  font-size:40px;
  font-weight:200;
  line-height:1.3;
}
h3, li{
  color: #e9c46a;
  font-family: 'Zen Kurenaido', sans-serif;
  font-size:30px;
  font-weight:200;
  line-height:1.3;
  padding-top: 50px;
}

iframe{
  width: 900px;
  height: 600px;
}

ul{
  list-style-type: none;
}


.img_text{
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.img{
  z-index: -5;
  position:absolute;
  /* margin-top:0px; */
}

.mapopacity{
  opacity:0;
  transition: opacity 0.8s;
  -webkit-transition: opacity 0.8s;
}

.list{
  text-align:center;
}

#map{
  text-align: center;
  padding-top: 100px;
}
#lastrow{
  padding-top: 200px;
}


#header{
text-align:center;
margin-bottom: 700px;
}
#img1{
  transition: opacity 1.2s;
  -webkit-transition: opacity 1.2s;
}
#text1{
  padding: 80px;
  transition: opacity 0.8s;
   -webkit-transition: opacity 0.8s;
}
#pin2{
  padding: 80px;
  transition: opacity 0.8s;
   -webkit-transition: opacity 0.8s;
}
#qlist{
  transition: opacity 0.8s;
   -webkit-transition: opacity 0.8s;
}

#finaltext{
  text-align:center;
}

.spacer{
  margin-bottom: 200px;
  margin-top: 200px;

}



.active {
      opacity:1;
  }


.deactive {
        opacity:0;
    }

/* div#trigger1{
  bottom: 0;
} */



</style>
</head>
<body>

<main role="main" class="container" >
  <div id= 'trigger1' style ></div>
  <div id = 'img1' class="img_container">
    <img class="img" src= "familyoutline.png" width= 100%; opacity = 75%; />
  </div>

  <div class='row', id='header'>
    <h1 class= 'img_text'>Characterizing Gendered Migration Journeys</h1>
    <h3 class='img_text'>Meera Gregerson, Kwesi Afrifa, & Sarah Lohmar</h3>
  </div>

  <div class='row'>
    <div class='col-12'>

      <div id= 'trigger2'></div>
      <div id='pin2'>
        <h2>Various economic, political, and X factors drive thousands of people each year to leave home in pursuit of a better life. The journey is long and often expensive, lonely, and dangerous.</h2>
        <h2>In order to better understand the experiences of people migrating, let alone to begin to address the challenges faced by such people, it is critical to examine how one's gender affects one's migration experience.</h2>
      </div>

      <br><br>
      <div id='trigger3'></div>
      <div class='list' id='qlist'>
        <ul id= 'pin3'>
          <li id="list1" class= 'active list_elt'>How much does the migration cost?</li>
          <li id="list2" class= ' list_elt'>What violence do they face along the way?</li>
          <li id="list3" class= 'list_elt'>With whom do they travel?</h3>
          <li id="list4" class= 'list_elt'>What work do they find when they arrive?</li>
          <li id="list5" class=  'list_elt'>How much do they send to their families back home?</li>
        </ul>
      </div>
      <br><br>
    </div>
  </div>

  <div class = 'row' id= 'row1'>
    <div class= 'col-8'>
      <h2>Let's now explore the migration path for women and men.</h2>
      <div id= 'trigger4'></div>
        <div id = 'sankey'></div>
        <canvas class="top" width="900" height="3200"></canvas>
        <svg class ="sankeyone" width="900" height="3200" transform = "translate(-1000,1200) rotate(90) scale(1, -1)"> </svg>

      </div>
    </div>

    <!-- <div class = 'col-4'>
        <div id = 'pin4'>
          <div id = 'text2'>
            <p> Here we have a two-column layout. On the left we can place our dynamic visualization, while on the right we can explain the key takeaways from the data.</p>
            <br>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Tincidunt nunc pulvinar sapien et ligula. Scelerisque in dictum non consectetur a erat nam. Nunc pulvinar sapien et ligula. Amet consectetur adipiscing elit duis tristique sollicitudin nibh. Aenean pharetra magna ac placerat vestibulum lectus. Facilisis leo vel fringilla est ullamcorper eget. Scelerisque in dictum non consectetur. Aliquam faucibus purus in massa tempor. </p>
          </div>
        </div>
    </div>
  </div>

  <div class='row spacer'></div>


  <div class= 'row spacer'><div>
  <div class= 'row col-12' id= 'row3'>

    <p>Finally we conclude at the bottom of all the visualizations. We tell you what we've told already. What are the key takeaways from these data?</p>
    <br>
    <p>Viverra suspendisse potenti nullam ac. Mauris nunc congue nisi vitae suscipit. Nisl purus in mollis nunc sed id semper. Duis at consectetur lorem donec massa. Donec et odio pellentesque diam volutpat commodo sed egestas egestas. Curabitur vitae nunc sed velit dignissim. Tellus integer feugiat scelerisque varius morbi enim nunc faucibus. Accumsan sit amet nulla facilisi morbi tempus. Mi eget mauris pharetra et ultrices. Erat imperdiet sed euismod nisi porta. Id venenatis a condimentum vitae sapien pellentesque. Adipiscing commodo elit at imperdiet dui. Parturient montes nascetur ridiculus mus.</p>
  </div> -->

</main>



<svg class ="sankeytwo" width="900" height="3200" transform = "translate(-1000,1200) rotate(90) scale(1, -1)"> </svg>
<!-- <canvas class = "bottom" width="900" height="3200" ></canvas> -->


<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js" charset="utf-8" type="text/javascript"></script>
<script src="d3.sankey.js" charset="utf-8" type="text/javascript"></script>

<script type="text/javascript">

// sankey one for migration experience

var margin = {top: 1, right: 1, bottom: 6, left: 1},
    // width = 960 - margin.left - margin.right,
    // height = 500 - margin.top - margin.bottom;
    width = 3000 - margin.left - margin.right,
    height = 900- margin.top - margin.bottom;

var formatNumber = d3.format(",.0f"),
    format = function(d) { return formatNumber(d) + " TWh"; },
    color = d3.scale.category20();

var svg = d3.select("svg.sankeyone")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var sankey = d3.sankey()
    .nodeWidth(15)
    .nodePadding(10)
    .size([width, height]);

var path = sankey.link();

var freqCounter = 1;

d3.json("energy.json", function(energy) {

  sankey
      .nodes(energy.nodes)
      .links(energy.links)
      .layout(32);

  var link = svg.append("g").selectAll(".link")
      .data(energy.links)
    .enter().append("path")
      .attr("class", "link")
      .attr("d", path)
      .style("stroke-width", function(d) { return Math.max(1, d.dy); })
      .sort(function(a, b) { return b.dy - a.dy; });

  link.append("title")
      .text(function(d) { return d.source.name + " → " + d.target.name + "\n" + format(d.value); });

  var node = svg.append("g").selectAll(".node")
      .data(energy.nodes)
    .enter().append("g")
      .attr("class", "node")
      // .attr("transform","rotate(90)")
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
    .call(d3.behavior.drag()
      .origin(function(d) { return d; })
      .on("dragstart", function() { this.parentNode.appendChild(this); })
      .on("drag", dragmove));

  node.append("rect")
      .attr("height", function(d) { return d.dy; })
      .attr("width", sankey.nodeWidth()+10)
      .style("fill", function(d) { return d.color = color(d.name.replace(/ .*/, "")); })
      // .style("fill", function(d) { return d.color = "red"; })
      .style("stroke", "none")
    .append("title")
      .text(function(d) { return d.name + "\n" + format(d.value); });

  node.append("text")
      // .attr("x", -6)
      .attr("y", function(d) {return sankey.nodeWidth()})
      // .attr("dy", ".35em")
      .attr("text-anchor", "end")
      .attr("transform", "scale(1,-1) rotate(-90)")
      .attr("fill","white")
      .text(function(d) { return d.name; })
    // .filter(function(d) { return d.x < width / 2; })
      .attr("x", sankey.nodeWidth())
      .attr("text-anchor", "start");

  function dragmove(d) {
    d3.select(this).attr("transform", "translate(" + d.x + "," + (d.y = Math.max(0, Math.min(height - d.dy, d3.event.y))) + ")");
    sankey.relayout();
    link.attr("d", path);
  }

      // });

  var linkExtent = d3.extent(energy.links, function (d) {return d.value});
  var frequencyScale = d3.scale.linear().domain(linkExtent).range([0.05,1]);
  var particleSize = d3.scale.linear().domain(linkExtent).range([1,5]);


  energy.links.forEach(function (link) {
    link.freq = frequencyScale(link.value);
    link.particleSize = 2;
    link.particleColor = d3.scale.linear().domain([0,1])
    .range([link.source.color, link.target.color]);
  })

  var t = d3.timer(tick, 1000);
  var particles = [];

  function tick(elapsed, time) {

    particles = particles.filter(function (d) {return d.current < d.path.getTotalLength()});

    d3.selectAll("path.link")
    .each(
      function (d) {
        for (var x = 0;x<2;x++) {
          var offset = (Math.random() - .5) * (d.dy - 4);

          if (Math.random() < d.freq) {
            var length = this.getTotalLength();
            particles.push({link: d, time: elapsed, offset: offset, path: this, length: length, animateTime: length, speed: 0.5 + (Math.random())})
          }
        }

      });

    particleEdgeCanvasPath(elapsed);
  }

  function particleEdgeCanvasPath(elapsed) {
    var context = d3.select("canvas").node().getContext("2d");

    context.clearRect(0,0,900,3200);


      context.fillStyle = "gray";
      context.lineWidth = "1px";
    for (var x in particles) {
        var currentTime = elapsed - particles[x].time;
        particles[x].current = currentTime * 0.15 * particles[x].speed;
        var currentPos = particles[x].path.getPointAtLength(particles[x].current);
        context.beginPath();
      context.fillStyle = particles[x].link.particleColor(0);
        context.arc(currentPos.y,currentPos.x+ particles[x].offset,particles[x].link.particleSize,2*Math.PI,0);

        context.fill();
    }
  }


});

// sankey two for occupational changes

var svgtwo = d3.select("svg.sankeytwo")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
  .append("g")
  .attr("transform", "translate(5000,5000)");

var sankeytwo = d3.sankey()
      .nodeWidth(15)
      .nodePadding(10)
      .size([width, height]);


var pathtwo = sankeytwo.link();


      d3.json("jobs.json", function(jobs) {

        sankey
            .nodes(jobs.nodes)
            .links(jobs.links)
            .layout(32);

        var linktwo = svgtwo.append("g").selectAll(".link")
            .data(jobs.links)
          .enter().append("pathtwo")
            .attr("class", "linktwo")
            .attr("d", "pathtwo")
            .style("stroke-width", function(d) { return Math.max(1, d.dy); })
            .sort(function(a, b) { return b.dy - a.dy; });

        linktwo.append("title")
            .text(function(d) { return d.source.name + " → " + d.target.name + "\n" + format(d.value); });

        var nodetwo = svgtwo.append("g").selectAll(".node")
            .data(jobs.nodes)
          .enter().append("g")
            .attr("class", "nodetwo")
            // .attr("transform","rotate(90)")
            .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
          .call(d3.behavior.drag()
            .origin(function(d) { return d; })
            .on("dragstart", function() { this.parentNode.appendChild(this); })
            .on("drag", dragmove));

        nodetwo.append("rect")
            .attr("height", function(d) { return d.dy; })
            .attr("width", sankey.nodeWidth()+10)
            .style("fill", function(d) { return d.color = color(d.name.replace(/ .*/, "")); })
            // .style("fill", function(d) { return d.color = "red"; })
            .style("stroke", "none")
          .append("title")
            .text(function(d) { return d.name + "\n" + format(d.value); });

        nodetwo.append("text")
            // .attr("x", -6)
            .attr("y", function(d) {return sankey.nodeWidth()})
            // .attr("dy", ".35em")
            .attr("text-anchor", "end")
            .attr("transform", "scale(1,-1) rotate(-90)")
            .attr("fill","white")
            .text(function(d) { return d.name; })
          // .filter(function(d) { return d.x < width / 2; })
            .attr("x", sankey.nodeWidth())
            .attr("text-anchor", "start");

        function dragmove(d) {
          d3.select("svg.sankeytwo").attr("transform", "translate(" + d.x + "," + (d.y = Math.max(0, Math.min(height - d.dy, d3.event.y))) + ")");
          sankeytwo.relayout();
          link.attr("d", path);
        }

            // });
        //
        // var linkExtent = d3.extent(energy.links, function (d) {return d.value});
        // var frequencyScale = d3.scale.linear().domain(linkExtent).range([0.05,1]);
        // var particleSize = d3.scale.linear().domain(linkExtent).range([1,5]);
        //
        //
        // energy.links.forEach(function (link) {
        //   link.freq = frequencyScale(link.value);
        //   link.particleSize = 2;
        //   link.particleColor = d3.scale.linear().domain([0,1])
        //   .range([link.source.color, link.target.color]);
        // })
        //
        // var t = d3.timer(tick, 1000);
        // var particles = [];
        //
        // function tick(elapsed, time) {
        //
        //   particles = particles.filter(function (d) {return d.current < d.path.getTotalLength()});
        //
        //   d3.selectAll("path.link")
        //   .each(
        //     function (d) {
        //       for (var x = 0;x<2;x++) {
        //         var offset = (Math.random() - .5) * (d.dy - 4);
        //
        //         if (Math.random() < d.freq) {
        //           var length = this.getTotalLength();
        //           particles.push({link: d, time: elapsed, offset: offset, path: this, length: length, animateTime: length, speed: 0.5 + (Math.random())})
        //         }
        //       }
        //
        //     });
        //
        //   particleEdgeCanvasPath(elapsed);
        // }
        //
        // function particleEdgeCanvasPath(elapsed) {
        //   var context = d3.select("canvas").node().getContext("2d");
        //
        //   context.clearRect(0,0,900,3200);
        //
        //
        //     context.fillStyle = "gray";
        //     context.lineWidth = "1px";
        //   for (var x in particles) {
        //       var currentTime = elapsed - particles[x].time;
        //       particles[x].current = currentTime * 0.15 * particles[x].speed;
        //       var currentPos = particles[x].path.getPointAtLength(particles[x].current);
        //       context.beginPath();
        //     context.fillStyle = particles[x].link.particleColor(0);
        //       context.arc(currentPos.y,currentPos.x+ particles[x].offset,particles[x].link.particleSize,2*Math.PI,0);
        //
        //       context.fill();
        //   }
        // }


      });




    </script>


    <script type="text/javascript">
        var controller = new ScrollMagic.Controller();


        //pin img1
        new ScrollMagic.Scene({
          triggerElement: '#trigger1',
          triggerHook: -.1
        })
          .setPin('#img1')
          .addTo(controller);

        //fade out img1
        new ScrollMagic.Scene({
              triggerElement: '#trigger2',
              triggerHook: 0.1,
            })
              .setClassToggle('#img1', 'deactive')
              .addTo(controller);

        //pin text 2
        new ScrollMagic.Scene({
            triggerElement: '#trigger2',
            triggerHook: 0.1,
            duration: 750,
            pushFollowers: false
          })
            .setPin('#pin2')
            .addTo(controller);

        // text 2 fade out
        new ScrollMagic.Scene({
          triggerElement: '#trigger3',
          triggerHook: 0.9
        })
          .setClassToggle('#pin2', 'deactive')
          .addTo(controller);

        //pin list of questions
        new ScrollMagic.Scene({
          triggerElement: '#trigger3',
          triggerHook: 0.1,
          duration: 1000
        })
          .setPin('#pin3')
          .addTo(controller);


        //fade out questions list
        new ScrollMagic.Scene({
          triggerElement: '#trigger4',
          triggerHook: 0.9
        })
        .setClassToggle('#qlist', 'deactive')
        .addTo(controller);

        new ScrollMagic.Scene({
          triggerElement: '#trigger6',
          triggerHook: 0,
          duration: 700
        })
        .setPin('#img3')
        .addTo(controller);




    </script>
</body>
</html>
